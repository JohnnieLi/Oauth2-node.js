<html lang="en">
  <head>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="414646750345-q77prfo2b7s87ki0di3i1jv5t3uh91ok.apps.googleusercontent.com">

<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

  </head>
  <body>
    <button id = "googleSignIN">Google SignIN</button>
    <script>

     (function ($) {
     var windowThatWasOpened

     $('#googleSignIN').on('click', function(){
       console.log("asd");
      $.ajax({
       method: "GET",
       url: "/url",
       data: {}
      })
      .done(function( data ) {
       console.log(data );
       windowThatWasOpened = window.open(data, "Please sign in with Google", "width=500,height=500");
      });


     })

     window.onmessage = function(e){
      // windowThatWasOpened.close();
       var urlWithCode = e.data;
       var idx = urlWithCode.lastIndexOf("code=");
       var code = urlWithCode.substring(idx+5).replace('#','');
       console.log(code);
      if(code){
        
       $.ajax({
       method: "GET",
       url: "/tokens",
       data: {'code' : code}
      })
      .done(function( data ) {
       console.log(data );
      });
      }
      
     }


}(jQuery));
    </script>
  </body>
</html>